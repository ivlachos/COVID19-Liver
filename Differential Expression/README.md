Differential expression analysis was carried out using limma-trend [111,112] to detect cluster gene markers. First, genes expressed in at least 5% of the nuclei of at least one cluster were selected and then UMI counts were normalized using the TMM normalization [113] implemented in edgeR v.3.28.1 [114]. Then, a linear model “~ Cluster + Batch” was fitted and modeled the mean-variance relationship with the limma-trend method [111] and a robust empirical Bayes procedure [115]. We used contrasts to compare the mean of a given cluster with all others; a gene is considered a cluster marker if the contrast is significant at an FDR < 0.05 and the cluster coefficient is higher than at least 75% of all other clusters. We performed comparisons at two levels: across all compartments (comparing all clusters identified) and within compartments (comparing clusters only from the same high-level cluster). We used limma to fit the same model “~ Cluster + Batch” on the pathway scores but without the mean-variance trend since the pathway scores are approximately normally distributed. The criteria to select pathway markers were identical to the cluster markers.
